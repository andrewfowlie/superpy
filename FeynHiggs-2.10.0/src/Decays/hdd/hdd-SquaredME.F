*#define CHECK

#if 0
* hdd-SquaredME.F
* assembly of squared matrix element
* generated by FormCalc 8.3 on 3-Dec-2013 17:01
* this file is part of FeynHiggs
#endif

#include "hdd-vars.h"
#include "inline.h"

************************************************************************

	subroutine hdd_SquaredMEHel(res)
	implicit none
	RealType res(*)

#include "hdd-vars.h"

	ComplexType amp
	RealType ampsq

* hdd-BEGIN ABBR_HEL
	call hdd_abbr0h
	call hdd_abbr1h
* hdd-END ABBR_HEL

	ampsq = 0
* hdd-BEGIN FF_TREE
	Ctree(1) = 0

	sub1L = 1

	call hdd_v0

	Cloop(1) = Ctree(1)

	Ctree(1) = 0

	sub1L = 0
	call hdd_v0
* hdd-END FF_TREE

* hdd-BEGIN M2_TREE
	amp = 0
	amp = amp + MatSUN(1,1)*Ctree(1)
	ampsq = ampsq + Re(Conjugate(Ctree(1))*amp)
* hdd-END M2_TREE
	res(1) = ampsq

	ampsq = 0
* hdd-BEGIN FF_LOOP

	call hdd_v1

	LOOP(Gen4, 1,3,1)
	call hdd_v1_Gen4
	ENDLOOP(Gen4)

	LOOP(Ind1, 1,3,1)
	LOOP(All4, 1,6,1)
	call hdd_v1_All4_Ind1
	ENDLOOP(All4)
	ENDLOOP(Ind1)

	LOOP(Cha5, 1,2,1)
	LOOP(Cha4, 1,2,1)
	call hdd_v1_Cha4_Cha5
	ENDLOOP(Cha4)
	ENDLOOP(Cha5)

	LOOP(Neu5, 1,4,1)
	LOOP(Neu4, 1,4,1)
	call hdd_v1_Neu4_Neu5
	ENDLOOP(Neu4)
	ENDLOOP(Neu5)

	LOOP(Neu5, 1,4,1)
	LOOP(Neu4, 1,4,1)
	LOOP(All4, 1,6,1)
	call hdd_v1_All4_Neu4_Neu5
	ENDLOOP(All4)
	ENDLOOP(Neu4)
	ENDLOOP(Neu5)

	LOOP(Ind2, 1,3,1)
	LOOP(Ind1, 1,3,1)
	LOOP(All5, 1,6,1)
	LOOP(All4, 1,6,1)
	call hdd_v1_All4_All5_Ind1_Ind2
	ENDLOOP(All4)
	ENDLOOP(All5)
	ENDLOOP(Ind1)
	ENDLOOP(Ind2)

	LOOP(Ind3, 1,3,1)
	LOOP(Ind2, 1,3,1)
	LOOP(Ind1, 1,3,1)
	LOOP(All5, 1,6,1)
	LOOP(All4, 1,6,1)
	call hdd_v1_All4_All5_Ind1_Ind2Ind3
	ENDLOOP(All4)
	ENDLOOP(All5)
	ENDLOOP(Ind1)
	ENDLOOP(Ind2)
	ENDLOOP(Ind3)

	LOOP(Neu4, 1,4,1)
	LOOP(Ind2, 1,3,1)
	LOOP(Ind1, 1,3,1)
	LOOP(All5, 1,6,1)
	LOOP(All4, 1,6,1)
	call hdd_v1_All4_All5_Ind1_Ind2Neu4
	ENDLOOP(All4)
	ENDLOOP(All5)
	ENDLOOP(Ind1)
	ENDLOOP(Ind2)
	ENDLOOP(Neu4)

	LOOP(Ind2, 1,3,1)
	LOOP(Ind1, 1,3,1)
	LOOP(Cha5, 1,2,1)
	LOOP(Cha4, 1,2,1)
	LOOP(All4, 1,6,1)
	call hdd_v1_All4_Cha4_Cha5_Ind1Ind2
	ENDLOOP(All4)
	ENDLOOP(Cha4)
	ENDLOOP(Cha5)
	ENDLOOP(Ind1)
	ENDLOOP(Ind2)

	LOOP(Ind4, 1,3,1)
	LOOP(Ind3, 1,3,1)
	LOOP(Ind2, 1,3,1)
	LOOP(Ind1, 1,3,1)
	LOOP(All5, 1,6,1)
	LOOP(All4, 1,6,1)
	call hdd_v1_All4All5Ind1Ind2Ind3Id4
	ENDLOOP(All4)
	ENDLOOP(All5)
	ENDLOOP(Ind1)
	ENDLOOP(Ind2)
	ENDLOOP(Ind3)
	ENDLOOP(Ind4)

	LOOP(Ind4, 1,3,1)
	LOOP(Ind3, 1,3,1)
	LOOP(Ind2, 1,3,1)
	LOOP(Ind1, 1,3,1)
	LOOP(Cha4, 1,2,1)
	LOOP(All5, 1,6,1)
	LOOP(All4, 1,6,1)
	call hdd_v1_All4All5Ca4Id1Id2Id3Id4
	ENDLOOP(All4)
	ENDLOOP(All5)
	ENDLOOP(Cha4)
	ENDLOOP(Ind1)
	ENDLOOP(Ind2)
	ENDLOOP(Ind3)
	ENDLOOP(Ind4)
* hdd-END FF_LOOP

* hdd-BEGIN M2_LOOP
	amp = 0
	amp = amp + MatSUN(1,1)*Cloop(1)
	ampsq = ampsq + Re(Conjugate(Ctree(1))*amp)
	ampsq = ampsq + ampsq
	amp = 0
	amp = amp + MatSUN(1,1)*Cloop(1)
	ampsq = ampsq + Re(Conjugate(Cloop(1))*amp)
* hdd-END M2_LOOP
	res(2) = ampsq
	end

************************************************************************

	subroutine hdd_SquaredME(result)
	implicit none
	RealType result(*)

#include "hdd-vars.h"

* hdd-BEGIN VAR_DECL
	integer i, h, hmax, hsimd
	parameter (hmax = 2)
	parameter (hsimd = hmax)
	RealType res(2,hsimd)
	RealType rtree, rloop
	external hdd_SquaredMEHel
* hdd-END VAR_DECL

	data MatSUN /1*bogus/

#include "inline.h"

* hdd-BEGIN INVARIANTS
* hdd-END INVARIANTS

* hdd-BEGIN ABBR_S
	call hdd_abbr0s
	call hdd_abbr1s
* hdd-END ABBR_S

* hdd-BEGIN ABBR_ANGLE
* hdd-END ABBR_ANGLE

* hdd-BEGIN HEL_LOOP
	h = 0

	do i = 0, hmax - 1

	  Hel(1) = 0
	  Hel(2) = -1 + 2*Mod(i/1,2)
	  Hel(3) = Hel(2)

	  h = h + 1; call hdd_SquaredMEHel(res(1,h))
	enddo

* hdd-END HEL_LOOP

* hdd-BEGIN RESULT
	rtree = 0
	rloop = 0
	do i = 1, h
	  rtree = rtree + res(1,i)
	  rloop = rloop + res(2,i)
	enddo
	result(1) = rtree
#ifdef WF_RENORMALIZATION
	rloop = rloop + (WF_RENORMALIZATION)*rtree
#endif
	result(2) = rloop
* hdd-END RESULT

#ifdef CHECK
	print *, 'tree =', rtree
	print *, 'loop =', rloop
	stop
#endif

* hdd-END SQUAREDME
	end

